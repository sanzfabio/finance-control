<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Control Pro</title>
    <style>
        :root {
            --color-bg-base: #0f172a;
            --color-bg-elevated: #020617;
            --color-bg-surface: #1e293b;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-accent: #38bdf8;
            --color-accent-hover: #0284c7;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--color-bg-base); color: var(--color-text-primary); font-family: var(--font-family); line-height: 1.6; padding: var(--spacing-md); }
        .container { max-width: 1200px; margin: 0 auto; }
        header { background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
        h1 { font-size: 2rem; margin-bottom: var(--spacing-xs); color: var(--color-accent); }
        .header-subtitle { color: var(--color-text-secondary); font-size: 0.9rem; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg); }
        .stat-card { background-color: var(--color-bg-surface); padding: var(--spacing-lg); border-radius: 8px; border-left: 4px solid var(--color-accent); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .stat-label { font-size: 0.85rem; color: var(--color-text-muted); margin-bottom: var(--spacing-xs); text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-value { font-size: 1.8rem; font-weight: 600; color: var(--color-text-primary); }
        .stat-value.income { color: var(--color-success); }
        .stat-value.expense { color: var(--color-danger); }
        .stat-value.balance { color: var(--color-accent); }
        .controls { background-color: var(--color-bg-surface); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .form-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-md); }
        .form-field { display: flex; flex-direction: column; }
        label { font-size: 0.9rem; color: var(--color-text-secondary); margin-bottom: var(--spacing-xs); font-weight: 500; }
        input, select { padding: var(--spacing-sm); background-color: var(--color-bg-base); border: 1px solid var(--color-text-muted); border-radius: 6px; color: var(--color-text-primary); font-family: var(--font-family); font-size: 0.95rem; transition: border-color 0.2s; }
        input:focus, select:focus { outline: none; border-color: var(--color-accent); box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2); }
        input::placeholder { color: var(--color-text-muted); }
        .button-group { display: flex; gap: var(--spacing-sm); flex-wrap: wrap; }
        button { padding: var(--spacing-sm) var(--spacing-lg); border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95rem; }
        .btn-primary { background-color: var(--color-accent); color: var(--color-bg-elevated); }
        .btn-primary:hover { background-color: var(--color-accent-hover); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-secondary { background-color: var(--color-bg-elevated); color: var(--color-text-primary); border: 1px solid var(--color-text-muted); }
        .btn-secondary:hover { background-color: var(--color-bg-surface); }
        .btn-secondary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-danger { background-color: var(--color-danger); color: white; padding: var(--spacing-xs) var(--spacing-sm); font-size: 0.85rem; }
        .btn-danger:hover { background-color: #dc2626; }
        .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-md); flex-wrap: wrap; }
        .filter-group { display: flex; align-items: center; gap: var(--spacing-xs); }
        .filter-group select { min-width: 150px; }
        .transactions { background-color: var(--color-bg-surface); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .transactions-header { background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-bottom: 1px solid var(--color-text-muted); font-weight: 600; display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr 1fr; gap: var(--spacing-md); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-text-muted); }
        .transaction-item { padding: var(--spacing-lg); border-bottom: 1px solid rgba(148, 163, 184, 0.1); display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr 1fr; gap: var(--spacing-md); align-items: center; transition: background-color 0.2s; }
        .transaction-item:hover { background-color: rgba(56, 189, 248, 0.05); }
        .transaction-item:last-child { border-bottom: none; }
        .transaction-desc { display: flex; flex-direction: column; }
        .transaction-desc strong { color: var(--color-text-primary); margin-bottom: var(--spacing-xs); }
        .transaction-desc small { color: var(--color-text-muted); font-size: 0.85rem; }
        .transaction-amount { font-weight: 600; font-size: 1.1rem; }
        .transaction-amount.income { color: var(--color-success); }
        .transaction-amount.expense { color: var(--color-danger); }
        .transaction-date { color: var(--color-text-muted); font-size: 0.9rem; }
        .transaction-actions { display: flex; gap: var(--spacing-xs); }
        .chart-container { background-color: var(--color-bg-surface); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        .chart-title { font-size: 1.2rem; font-weight: 600; margin-bottom: var(--spacing-md); color: var(--color-accent); }
        .pie-chart { display: flex; gap: var(--spacing-lg); flex-wrap: wrap; align-items: center; }
        .chart-legend { flex: 1; min-width: 250px; }
        .legend-item { display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm); font-size: 0.9rem; }
        .legend-color { width: 16px; height: 16px; border-radius: 3px; }
        .no-data { text-align: center; padding: var(--spacing-xl); color: var(--color-text-muted); }
        .tabs { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--color-text-muted); }
        .tab { padding: var(--spacing-sm) var(--spacing-md); background: none; border: none; color: var(--color-text-secondary); cursor: pointer; font-weight: 500; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .tab.active { color: var(--color-accent); border-bottom-color: var(--color-accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        @media (max-width: 768px) {
            .transactions-header, .transaction-item { grid-template-columns: 1fr; }
            .dashboard { grid-template-columns: 1fr; }
            h1 { font-size: 1.5rem; }
            .form-group { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-md);">
                <div>
                    <h1>üí∞ Finance Control Pro</h1>
                    <p class="header-subtitle">Gest√£o financeira pessoal e familiar | Controle completo de receitas e despesas</p>
                </div>
                <div style="display: flex; gap: var(--spacing-sm); align-items: center; flex-wrap: wrap;">
                    <div id="syncStatus" style="font-size: 0.9rem; white-space: nowrap;"></div>
                    <button id="googleSignIn" class="btn-primary" style="display: none; margin: 0;">üîê Login Google</button>
                    <button id="googleSignOut" class="btn-secondary" style="display: none; margin: 0;">üö™ Sair</button>
                </div>
            </div>
        </header>
        <div class="dashboard">
            <div class="stat-card"><div class="stat-label">Saldo Total</div><div class="stat-value balance" id="totalBalance">R$ 0,00</div></div>
            <div class="stat-card"><div class="stat-label">Receitas (M√™s)</div><div class="stat-value income" id="totalIncome">R$ 0,00</div></div>
            <div class="stat-card"><div class="stat-label">Despesas (M√™s)</div><div class="stat-value expense" id="totalExpense">R$ 0,00</div></div>
            <div class="stat-card"><div class="stat-label">Poupan√ßa (M√™s)</div><div class="stat-value balance" id="totalSavings">R$ 0,00</div></div>
        </div>
Perfeito! √ìtima estrat√©gia usar o Notepad++! üëç

***

### **PARTE 2 de 3 - Continue colando ap√≥s a √∫ltima linha da PARTE 1:**

A √∫ltima linha da PARTE 1 terminou em:
```html
        </div>
```

Agora cole isto logo abaixo (continua√ß√£o):

```html
        <div class="controls">
            <h2 style="margin-bottom: var(--spacing-md); color: var(--color-accent);">üìù Registrar Transa√ß√£o</h2>
            <div class="form-group">
                <div class="form-field"><label>Descri√ß√£o</label><input type="text" id="description" placeholder="Ex: Sal√°rio, Supermercado..."></div>
                <div class="form-field"><label>Valor (R$)</label><input type="number" id="amount" placeholder="0,00" step="0.01" min="0"></div>
                <div class="form-field"><label>Tipo</label><select id="transactionType"><option value="expense">Despesa</option><option value="income">Receita</option></select></div>
                <div class="form-field"><label>Categoria</label><select id="category"><option value="Alimenta√ß√£o">Alimenta√ß√£o</option><option value="Transporte">Transporte</option><option value="Sa√∫de">Sa√∫de</option><option value="Educa√ß√£o">Educa√ß√£o</option><option value="Entretenimento">Entretenimento</option><option value="Sal√°rio">Sal√°rio</option><option value="Investimento">Investimento</option><option value="Outros">Outros</option></select></div>
                <div class="form-field"><label>Data</label><input type="date" id="transactionDate"></div>
                <div class="form-field"><label>Membro da Fam√≠lia</label><input type="text" id="member" placeholder="Seu nome ou membro"></div>
            </div>
            <div class="button-group">
                <button class="btn-primary" onclick="addTransaction()">‚ûï Adicionar Transa√ß√£o</button>
                <button class="btn-secondary" onclick="clearForm()">üîÑ Limpar</button>
            </div>
        </div>
        <div class="chart-container">
            <div class="chart-title">üìä Distribui√ß√£o de Despesas por Categoria</div>
            <div id="chartContent" class="pie-chart"><p class="no-data">Nenhuma despesa registrada ainda</p></div>
        </div>
        <div class="controls">
            <h2 style="margin-bottom: var(--spacing-md); color: var(--color-accent);">üéØ Metas Or√ßament√°rias</h2>
            <div class="form-group">
                <div class="form-field"><label>Categoria</label><select id="budgetCategory"><option value="Alimenta√ß√£o">Alimenta√ß√£o</option><option value="Transporte">Transporte</option><option value="Sa√∫de">Sa√∫de</option><option value="Educa√ß√£o">Educa√ß√£o</option><option value="Entretenimento">Entretenimento</option></select></div>
                <div class="form-field"><label>Limite Mensal (R$)</label><input type="number" id="budgetLimit" placeholder="0,00" step="0.01" min="0"></div>
            </div>
            <div class="button-group"><button class="btn-primary" onclick="setBudget()">üéØ Definir Meta</button></div>
        </div>
        <div class="controls">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('transactions')">üìã Hist√≥rico</button>
                <button class="tab" onclick="switchTab('budgets')">üéØ Metas</button>
                <button class="tab" onclick="switchTab('export')">üì• Relat√≥rios</button>
            </div>
            <div id="transactions" class="tab-content active">
                <h2 style="margin-bottom: var(--spacing-md); color: var(--color-accent);">üìã Hist√≥rico de Transa√ß√µes</h2>
                <div class="filters">
                    <div class="filter-group"><label style="margin-bottom: 0;">Tipo:</label><select id="filterType" onchange="updateTransactionList()"><option value="">Todas</option><option value="income">Receitas</option><option value="expense">Despesas</option></select></div>
                    <div class="filter-group"><label style="margin-bottom: 0;">M√™s:</label><input type="month" id="filterMonth" value="" onchange="updateTransactionList()"></div>
                </div>
                <div class="transactions">
                    <div class="transactions-header"><div>Descri√ß√£o</div><div>Valor</div><div>Tipo</div><div>Data</div><div>A√ß√µes</div></div>
                    <div id="transactionsList"></div>
                </div>
            </div>
            <div id="budgets" class="tab-content">
                <h2 style="margin-bottom: var(--spacing-md); color: var(--color-accent);">üéØ Acompanhamento de Metas</h2>
                <div id="budgetsList"></div>
            </div>
            <div id="export" class="tab-content">
                <h2 style="margin-bottom: var(--spacing-md); color: var(--color-accent);">üì• Backup, Restaura√ß√£o e Relat√≥rios</h2>
                <div style="background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg); border-left: 4px solid var(--color-success);">
                    <h3 style="color: var(--color-success); margin-bottom: var(--spacing-md);">üíæ Backup de Dados</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">Fa√ßa backup de todos seus dados em arquivo JSON para prote√ß√£o e compartilhamento com familiares.</p>
                    <div class="button-group">
                        <button class="btn-primary" onclick="backupToJSON()">üíæ Baixar Backup (JSON)</button>
                        <button class="btn-secondary" onclick="document.getElementById('restoreFile').click()">üìÇ Restaurar do Arquivo</button>
                        <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreFromJSON(event)">
                    </div>
                </div>
                <div style="background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-radius: 8px; margin-bottom: var(--spacing-lg); border-left: 4px solid var(--color-accent);">
                    <h3 style="color: var(--color-accent); margin-bottom: var(--spacing-md);">üìä Relat√≥rios</h3>
                    <div class="form-group">
                        <div class="form-field"><label>Per√≠odo</label><select id="reportPeriod"><option value="month">M√™s Atual</option><option value="quarter">Trimestre</option><option value="year">Ano</option></select></div>
                    </div>
                    <div class="button-group">
                        <button class="btn-primary" onclick="generateReport()">üìä Gerar Relat√≥rio</button>
                        <button class="btn-secondary" onclick="exportToCSV()">üì• Exportar para CSV</button>
                    </div>
                </div>
                <div style="background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-radius: 8px; border-left: 4px solid var(--color-danger);">
                    <h3 style="color: var(--color-danger); margin-bottom: var(--spacing-md);">‚ö†Ô∏è Gerenciar Dados</h3>
                    <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">Opera√ß√µes irrevers√≠veis. Use com cuidado!</p>
                    <div class="button-group"><button class="btn-secondary" onclick="clearAllData()">üóëÔ∏è Limpar Todos os Dados</button></div>
                </div>
                <div id="reportOutput" style="margin-top: var(--spacing-lg);"></div>
            </div>
        </div>
    </div>
    <script>
        const CLIENT_ID = '847583487125-j2q3p5r8k9m0n1o2p3q4r5s6t7u8v9w0.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const APP_FOLDER_ID = '1nJKJF4CgCWPVYB1F2nyA-GUgPvnwK47l';
        const BACKUP_FILENAME = 'finance_data.json';
        let tokenClient, gapiInited = false, gisInited = false, backupFileId = null, isOnline = navigator.onLine;
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let budgets = JSON.parse(localStorage.getItem('budgets')) || {};
        window.addEventListener('load', function() {
            document.getElementById('transactionDate').valueAsDate = new Date();
            document.getElementById('filterMonth').value = new Date().toISOString().slice(0, 7);
            loadLocalData(); updateDashboard(); updateTransactionList(); updateChart(); updateBudgetsList(); setupOnlineOfflineListeners();
        });
        function gapiLoaded() { gapi.load('client', initializeGapiClient); }
        async function initializeGapiClient() {
            try { await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] }); gapiInited = true; maybeEnableButtons(); }
            catch (err) { console.error('Google API init error:', err); setStatus('error', 'Erro ao inicializar Google API'); }
        }
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: SCOPES, callback: '' });
            gisInited = true; maybeEnableButtons();
        }
        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('googleSignIn').style.display = 'block';
                document.getElementById('googleSignIn').disabled = false;
                setStatus('warn', 'Fa√ßa login com Google para sincronizar automaticamente');
            }
        }
        function setStatus(type, message) {
            const statusEl = document.getElementById('syncStatus');
            if (!statusEl) return;
            let color = 'var(--color-warning)';
            if (type === 'ok') color = 'var(--color-success)';
            if (type === 'error') color = 'var(--color-danger)';
            statusEl.innerHTML = `<span style="color: ${color};">${message}</span>`;
        }
        function setupOnlineOfflineListeners() {
            window.addEventListener('online', () => { isOnline = true; if (gapi.client.getToken()) setStatus('ok', '‚úÖ Online - Sincronizado com Google Drive'); });
            window.addEventListener('offline', () => { isOnline = false; setStatus('warn', 'üì° Modo Offline - Dados salvos localmente'); });
        }
        document.getElementById('googleSignIn').onclick = handleAuthClick;
        document.getElementById('googleSignOut').onclick = handleSignoutClick;
        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error) { console.error(resp); setStatus('error', 'Erro na autentica√ß√£o'); return; }
                document.getElementById('googleSignIn').style.display = 'none';
                document.getElementById('googleSignOut').style.display = 'block';
                setStatus('ok', '‚úÖ Autenticado - Sincronizando...');
                await findOrCreateBackupFile(); await syncCloudToLocal();
            };
            if (gapi.client.getToken() === null) tokenClient.requestAccessToken({ prompt: 'consent' });
            else tokenClient.requestAccessToken({ prompt: '' });
        }
        function handleSignoutClick() {
            const token = gapi.client.getToken();
            if (token !== null) { google.accounts.oauth2.revoke(token.access_token); gapi.client.setToken(''); }
            document.getElementById('googleSignIn').style.display = 'block';
            document.getElementById('googleSignOut').style.display = 'none';
            backupFileId = null; setStatus('warn', 'Desconectado do Google Drive');
        }
        async function findOrCreateBackupFile() {
            try {
                const res = await gapi.client.drive.files.list({
                    q: `name = '${BACKUP_FILENAME}' and '${APP_FOLDER_ID}' in parents and trashed = false`,
                    fields: 'files(id, name)', spaces: 'drive', pageSize: 1
                });
                if (res.result.files && res.result.files.length > 0) { backupFileId = res.result.files[0].id; console.log('Arquivo encontrado:', backupFileId); }
                else { await createBackupFile(); }
            } catch (err) { console.error('Erro ao buscar arquivo:', err); setStatus('error', 'Erro ao buscar arquivo no Drive'); }
        }
        async function createBackupFile() {
            try {
                const backup = { version: '2.0', exportDate: new Date().toISOString(), transactions: transactions, budgets: budgets };
                const fileMetadata = { name: BACKUP_FILENAME, mimeType: 'application/json', parents: [APP_FOLDER_ID] };
                const boundary = '-------314159265358979323846';
                const delimiter = '\r\n--' + boundary + '\r\n';
                const closeDelim = '\r\n--' + boundary + '--';
                const content = JSON.stringify(backup, null, 2);
                const body = delimiter + 'Content-Type: application/json; charset=UTF-8\r\n\r\n' + JSON.stringify(fileMetadata) + delimiter + 'Content-Type: application/json\r\n\r\n' + content + closeDelim;
                const createRes = await gapi.client.request({
                    path: '/upload/drive/v3/files', method: 'POST', params: { uploadType: 'multipart' },
                    headers: { 'Content-Type': 'multipart/related; boundary=' + boundary }, body
                });
                backupFileId = createRes.result.id; console.log('Arquivo criado:', backupFileId); setStatus('ok', '‚úÖ Arquivo criado no Drive');
            } catch (err) { console.error('Erro ao criar arquivo:', err); setStatus('error', 'Erro ao criar arquivo no Drive'); }
        }
        async function syncLocalToCloud() {
            if (!isOnline || !gapi.client.getToken() || !backupFileId) return;
            try {
                setStatus('warn', 'üîÑ Sincronizando com Drive...');
                const backup = { version: '2.0', exportDate: new Date().toISOString(), transactions: transactions, budgets: budgets };
                const content = JSON.stringify(backup, null, 2);
                await gapi.client.request({
                    path: `/upload/drive/v3/files/${backupFileId}`, method: 'PATCH', params: { uploadType: 'media' },
                    headers: { 'Content-Type': 'application/json' }, body: content
                });
                localStorage.setItem('lastSync', Date.now()); setStatus('ok', '‚úÖ Sincronizado com Google Drive');
            } catch (err) { console.error('Erro ao salvar no Drive:', err); setStatus('error', 'Erro ao sincronizar com Drive'); }
        }
        async function syncCloudToLocal() {
            if (!isOnline || !gapi.client.getToken() || !backupFileId) return;
            try {
                const fileRes = await gapi.client.drive.files.get({ fileId: backupFileId, alt: 'media' });
                const cloudData = fileRes.result;
                if (cloudData && cloudData.transactions && cloudData.budgets) {
                    const localTimestamp = parseInt(localStorage.getItem('lastSync') || '0', 10);
                    const cloudTimestamp = new Date(cloudData.exportDate).getTime();
                    if (cloudTimestamp > localTimestamp) {
                        transactions = cloudData.transactions; budgets = cloudData.budgets;
                        localStorage.setItem('transactions', JSON.stringify(transactions));
                        localStorage.setItem('budgets', JSON.stringify(budgets));
                        localStorage.setItem('lastSync', cloudTimestamp);
                        updateDashboard(); updateTransactionList(); updateChart(); updateBudgetsList();
                        console.log('Dados carregados do Drive');
                    }
                }
                setStatus('ok', '‚úÖ Sincronizado com Google Drive');
            } catch (err) { console.error('Erro ao carregar do Drive:', err); setStatus('error', 'Erro ao carregar do Drive'); }
        }
        function loadLocalData() {
            transactions = JSON.parse(localStorage.getItem('transactions')) || [];
            budgets = JSON.parse(localStorage.getItem('budgets')) || {};
        }
        function addTransaction() {
            const description = document.getElementById('description').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('transactionType').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('transactionDate').value;
            const member = document.getElementById('member').value.trim() || 'Eu';
            if (!description || !amount || amount <= 0 || !date) { alert('‚ö†Ô∏è Preencha todos os campos corretamente!'); return; }
            const transaction = { id: Date.now(), description, amount, type, category, date, member };
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            clearForm(); updateDashboard(); updateTransactionList(); updateChart(); syncLocalToCloud();
        }
        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateDashboard(); updateTransactionList(); updateChart(); syncLocalToCloud();
            }
        }
        function clearForm() {
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('transactionType').value = 'expense';
            document.getElementById('category').value = 'Alimenta√ß√£o';
            document.getElementById('member').value = '';
            document.getElementById('transactionDate').valueAsDate = new Date();
        }
        function updateDashboard() {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
            const monthTransactions = transactions.filter(t => t.date.startsWith(currentMonth));
            const totalIncome = monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const totalBalance = transactions.reduce((sum, t) => t.type === 'income' ? sum + t.amount : sum - t.amount, 0);
            const totalSavings = totalIncome - totalExpense;
            document.getElementById('totalBalance').textContent = formatCurrency(totalBalance);
            document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings);
        }
        function updateTransactionList() {
            const filterType = document.getElementById('filterType').value;
            const filterMonth = document.getElementById('filterMonth').value;
            let filtered = transactions;
            if (filterType) filtered = filtered.filter(t => t.type === filterType);
            if (filterMonth) filtered = filtered.filter(t => t.date.startsWith(filterMonth));
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            const list = document.getElementById('transactionsList');
            if (filtered.length === 0) { list.innerHTML = '<p class="no-data">Nenhuma transa√ß√£o encontrada</p>'; return; }
            list.innerHTML = filtered.map(t => `
                <div class="transaction-item">
                    <div class="transaction-desc"><strong>${t.description}</strong><small>${t.category} ‚Ä¢ ${t.member}</small></div>
                    <div class="transaction-amount ${t.type}">${t.type === 'income' ? '+' : '-'} ${formatCurrency(t.amount)}</div>
                    <div style="color: ${t.type === 'income' ? '#10b981' : '#ef4444'};">${t.type === 'income' ? 'üì•' : 'üì§'}</div>
                    <div class="transaction-date">${formatDate(t.date)}</div>
                    <div class="transaction-actions"><button class="btn-danger" onclick="deleteTransaction(${t.id})">üóëÔ∏è</button></div>
                </div>
            `).join('');
        }
        function updateChart() {
            const expensesByCategory = {};
            transactions.filter(t => t.type === 'expense').forEach(t => { expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount; });
            const categories = Object.keys(expensesByCategory);
            if (categories.length === 0) { document.getElementById('chartContent').innerHTML = '<p class="no-data">Nenhuma despesa registrada ainda</p>'; return; }
            const colors = ['#38bdf8', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];
            const total = Object.values(expensesByCategory).reduce((a, b) => a + b, 0);
            const chartSVG = `<svg width="200" height="200" viewBox="0 0 200 200" style="flex-shrink: 0;">${generatePieChart(expensesByCategory, colors)}</svg>`;
            const legend = categories.map((cat, i) => {
                const percentage = ((expensesByCategory[cat] / total) * 100).toFixed(1);
                return `<div class="legend-item"><div class="legend-color" style="background-color: ${colors[i % colors.length]};"></div><span>${cat}: ${formatCurrency(expensesByCategory[cat])} (${percentage}%)</span></div>`;
            }).join('');
            document.getElementById('chartContent').innerHTML = `${chartSVG}<div class="chart-legend">${legend}</div>`;
        }
        function generatePieChart(data, colors) {
            const total = Object.values(data).reduce((a, b) => a + b, 0);
            let currentAngle = 0, slices = '';
            Object.entries(data).forEach(([category, value], index) => {
                const sliceAngle = (value / total) * 360;
                const startAngle = currentAngle, endAngle = currentAngle + sliceAngle;
                const x1 = 100 + 90 * Math.cos((startAngle * Math.PI) / 180);
                const y1 = 100 + 90 * Math.sin((startAngle * Math.PI) / 180);
                const x2 = 100 + 90 * Math.cos((endAngle * Math.PI) / 180);
                const y2 = 100 + 90 * Math.sin((endAngle * Math.PI) / 180);
                const largeArc = sliceAngle > 180 ? 1 : 0;
                const pathData = `M 100 100 L ${x1} ${y1} A 90 90 0 ${largeArc} 1 ${x2} ${y2} Z`;
                slices += `<path d="${pathData}" fill="${colors[index % colors.length]}" />`;
                currentAngle = endAngle;
            });
            return slices;
        }
        function setBudget() {
            const category = document.getElementById('budgetCategory').value;
            const limit = parseFloat(document.getElementById('budgetLimit').value);
            if (!limit || limit <= 0) { alert('‚ö†Ô∏è Digite um limite v√°lido!'); return; }
            budgets[category] = limit;
            localStorage.setItem('budgets', JSON.stringify(budgets));
            document.getElementById('budgetLimit').value = '';
            updateBudgetsList(); syncLocalToCloud();
        }
        function updateBudgetsList() {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
            const monthTransactions = transactions.filter(t => t.date.startsWith(currentMonth) && t.type === 'expense');
            const list = document.getElementById('budgetsList');
            if (Object.keys(budgets).length === 0) { list.innerHTML = '<p class="no-data">Nenhuma meta definida</p>'; return; }
            list.innerHTML = Object.entries(budgets).map(([category, limit]) => {
                const spent = monthTransactions.filter(t => t.category === category).reduce((sum, t) => sum + t.amount, 0);
                const percentage = (spent / limit) * 100;
                const status = percentage > 100 ? 'Excedido' : percentage > 75 ? 'Aten√ß√£o' : 'OK';
                const statusColor = percentage > 100 ? '#ef4444' : percentage > 75 ? '#f59e0b' : '#10b981';
                return `<div style="background-color: var(--color-bg-elevated); padding: var(--spacing-lg); margin-bottom: var(--spacing-md); border-radius: 8px; border-left: 4px solid ${statusColor};">
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm);"><strong>${category}</strong><span style="color: ${statusColor}; font-weight: 600;">${status}</span></div>
                    <div style="margin-bottom: var(--spacing-sm);"><div style="background-color: var(--color-bg-base); height: 10px; border-radius: 5px; overflow: hidden;"><div style="background-color: ${statusColor}; width: ${Math.min(percentage, 100)}%; height: 100%; transition: width 0.3s;"></div></div></div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--color-text-secondary);"><span>Gasto: ${formatCurrency(spent)}</span><span>Limite: ${formatCurrency(limit)}</span><span>${percentage.toFixed(0)}%</span></div>
                    <button class="btn-danger" onclick="deleteBudget('${category}')" style="margin-top: var(--spacing-md);">Remover Meta</button></div>`;
            }).join('');
        }
        function deleteBudget(category) { delete budgets[category]; localStorage.setItem('budgets', JSON.stringify(budgets)); updateBudgetsList(); syncLocalToCloud(); }
        function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            let filtered = [...transactions];
            const today = new Date();
            if (period === 'month') {
                const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
                filtered = filtered.filter(t => t.date.startsWith(currentMonth));
            } else if (period === 'quarter') {
                const quarter = Math.floor(today.getMonth() / 3);
                filtered = filtered.filter(t => {
                    const tDate = new Date(t.date);
                    const tQuarter = Math.floor(tDate.getMonth() / 3);
                    return tQuarter === quarter && tDate.getFullYear() === today.getFullYear();
                });
            } else if (period === 'year') {
                const year = today.getFullYear();
                filtered = filtered.filter(t => t.date.startsWith(year));
            }
            const income = filtered.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = income - expense;
            const report = `<div style="background-color: var(--color-bg-elevated); padding: var(--spacing-lg); border-radius: 8px;">
                <h3 style="color: var(--color-accent); margin-bottom: var(--spacing-md);">üìä Relat√≥rio - ${period === 'month' ? 'M√™s Atual' : period === 'quarter' ? 'Trimestre' : 'Ano'}</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md);">
                    <div><div style="color: var(--color-text-muted); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Receitas</div><div style="font-size: 1.5rem; color: var(--color-success); font-weight: 600;">${formatCurrency(income)}</div></div>
                    <div><div style="color: var(--color-text-muted); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Despesas</div><div style="font-size: 1.5rem; color: var(--color-danger); font-weight: 600;">${formatCurrency(expense)}</div></div>
                    <div><div style="color: var(--color-text-muted); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Saldo</div><div style="font-size: 1.5rem; color: ${balance >= 0 ? 'var(--color-success)' : 'var(--color-danger)'}; font-weight: 600;">${formatCurrency(balance)}</div></div>
                </div></div>`;
            document.getElementById('reportOutput').innerHTML = report;
        }
        function exportToCSV() {
            const headers = ['Data', 'Descri√ß√£o', 'Valor', 'Tipo', 'Categoria', 'Membro'];
            const rows = transactions.map(t => [t.date, t.description, t.amount, t.type === 'income' ? 'Receita' : 'Despesa', t.category, t.member]);
            const csv = [headers.join(','), ...rows.map(row => row.map(cell => `"${cell}"`).join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `financas_${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        function backupToJSON() {
            const backup = { version: '2.0', exportDate: new Date().toISOString(), transactions: transactions, budgets: budgets };
            const json = JSON.stringify(backup, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `finance_backup_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
            alert('‚úÖ Backup baixado com sucesso!');
        }
        function restoreFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (!backup.transactions || !backup.budgets) { alert('‚ùå Arquivo de backup inv√°lido!'); return; }
                    const choice = confirm('‚úÖ Arquivo carregado!\n\nOK = Mesclar (combinar dados)\nCancelar = Substituir (substituir todos os dados)');
                    if (choice) {
                        transactions = [...transactions, ...backup.transactions];
                        Object.assign(budgets, backup.budgets);
                        alert('‚úÖ Dados mesclados com sucesso!');
                    } else {
                        if (confirm('‚ö†Ô∏è Tem certeza que deseja SUBSTITUIR todos os dados atuais?')) {
                            transactions = backup.transactions;
                            budgets = backup.budgets;
                            alert('‚úÖ Dados restaurados com sucesso!');
                        }
                    }
                    localStorage.setItem('transactions', JSON.stringify(transactions));
                    localStorage.setItem('budgets', JSON.stringify(budgets));
                    updateDashboard(); updateTransactionList(); updateChart(); updateBudgetsList(); syncLocalToCloud();
                } catch (error) { alert('‚ùå Erro ao ler arquivo: ' + error.message); }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
        function clearAllData() {
            if (confirm('‚ö†Ô∏è Tem certeza? Esta a√ß√£o √© irrevers√≠vel!')) {
                if (confirm('Confirme novamente para apagar TODOS os dados')) {
                    transactions = []; budgets = {};
                    localStorage.removeItem('transactions');
                    localStorage.removeItem('budgets');
                    updateDashboard(); updateTransactionList(); updateChart(); updateBudgetsList(); syncLocalToCloud();
                    alert('‚úÖ Dados apagados com sucesso');
                }
            }
        }
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        function formatCurrency(value) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value); }
        function formatDate(dateString) { return new Intl.DateTimeFormat('pt-BR').format(new Date(dateString)); }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>


